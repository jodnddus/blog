---
title: "웹 설문 프로젝트 🔥"
date: "2021-10-09"
description: "포켓서베이의 설문 엔진 제작"
categories: [devlog]
comments: true
---

_포켓서베이는 본래 카카오톡 환경에서 설문을 진행하는 기술로 서베이 사업을 했었다. 자연스럽게 카카오톡 의존도가 높아졌는데, 카카오톡 의존도를 낮추고, 독자적인 설문 플랫폼을 만들기 위해 웹에서 진행할 수 있는 설문 엔진을 만들기로 했다._

---

웹 설문은 말 그대로 웹 브라우저에서 설문을 할 수 있는 기능이고 사용 가능한 환경은 아래와 같다.

- 데스크탑 웹 브라우저
- 모바일 웹 브라우저

동작되는 것을 보고싶으시다면 아래 영상을 참조하시면 됩니다.

[웹 설문 시연 영상\_데스크탑.mov](https://drive.google.com/file/d/1TWT6kEqaZcLhcXRCOLlcT226ZEYxWM4S/view?usp=drivesdk)

[웹 설문 시연 영상\_모바일.mov](https://drive.google.com/file/d/1Zpcd7Mv3BrjlLWZOGDrDsiI-kRSRi33d/view?usp=drivesdk)

웹 설문은 지금도 사용자의 편의를 위해 새로운 기능들이 추가되고 있다. 이를테면 주관식 입력 문항에 계좌번호, 전화번호, 주소 등 어떤 성격을 띠는 텍스트 입력값에 포맷을 부여하는 기능이 있다.

이 글에서는 웹 설문이 어떤 과정으로 개발 되었는지 회고 겸 개발기를 다룬다.

## 개발기

### phase 1

제일 처음 개발을 시작했을 때는 아래와 같은 개발 목표가 있었다. 당시 비즈니스를 위해서 챗봇 설문의 로직을 웹 브라우저로 옮기는 작업을 했다고 말해도 무방하다.

- 현재 포켓서베이 챗봇 설문조사 엔진의 한계를 그대로 적용
- 스크롤 방식의 전통적 웹 설문조사 도구
- 설문조사 분기 설정을 지원하지 않음

phase1에서 개발할 기능들을 큼지막하게 나열해 본다면 아래와 같다.

- 설문 구조 렌더링
- 문항 응답 시 시점 이동
- 타이머 기능

**설문 구조 렌더링**

개발 작업은 설문 데이터 구조를 보고 문항 타입별로 만든 문항 컴포넌트를 렌더링하는 방식으로 개발했다.

![web-survey-1](../assets/web-survey-1.png)

이렇게 설문 구조를 표현하는 작업을 완료하였다.

**문항 응답 시 시점 이동**

원래는 문항 길이를 계산해서 응답이 완료되면 그만큼 스크롤을 내리는 방식으로 구현하려고 계획했다. 하지만 앵커 기능을 이용하면 쉽고 빠르게 구현할 수 있을 것 같아서 앵커를 이용해서 아래와 같은 로직을 만들었다.

각 문항에 'question-N' 으로 id를 부여하고 선택지가 선택되어 응답이 완료될 때마다 해당 id로 스크롤이 이동되게 하는 방식으로 문항 이동을 구현하였다.

**타이머 기능**

Timer라는 클래스를 만들었다. 이 클래스는 startedAt, finishedAt, duration 멤버변수가 있고 start(), end() 메서드를 가지고 있다. 설문 페이지 진입 시 문항 개수만큼 인스턴스를 만들고 각 인스턴스를 문항 컴포넌트에 props로 넣어주고 메서드를 이용해서 응답 시간을 체크하게 만들었다.

### phase 2

프로토타이핑에 가까운 phase 1단계 작업을 마치고 운영을 한 뒤에 추가된 기능은 브랜칭 기능이다. 지금 응답하는 문항의 결과에 따라서 다른 문항이 표시되는 기능이다. 당시 나의 개발 역량으로는 버거운기능이였는지, 몇일 머리를 감싸고 고민했던 기억이 있다.

결과적으로 말하면 문항 렌더링을 표현하는 displaying이라는 이름을 가진 배열을 만들고 이 배열을 iteration을 하며 문항을 렌더링하는 방향으로 개발을 했다. 문항이 응답되면 이 displaying 배열을 브랜칭 규칙에 맞게 다시 세팅하는 함수를 호출하는 코드를 각 문항 컴포넌트에 적용해야하는 수고가 있었다.

![web-survey-2](../assets/web-survey-2.png)

지금 개발한다고 하면 이 displaying 배열을 따로 만들지 않고 각 문항 객체에 isDisplaying이라는 속성을 만들어서 종속시켰을 것 같다. 전 phase에서 사용하던 setQuestion 액션 함수를 이용할 수 있기 때문이다.

### phase 3

두번째 phase까지 완료되고 난 다음에는 패턴분리 없이, 리팩토링 없이 쌓아왔던 코드들을 정리하는 작업을 진행하였다. 아무래도 지속적인 기능 추가가 예상되는 기능인 만큼, 추후 기능 개발 편의성과 기능 개발 속도를 위해서 사용하지 않는 코드들은 지우고, 읽기 힘든 코드들은 가독성을 챙기는 작업이 필요하다고 판단했었다.

제일 먼저 문항 안에 사용되는 컴포넌트들을 다 쪼개는 작업을 했다. 문항 제목 컴포넌트, 문항 번호 컴포넌트, 선택지 컴포넌트, 이미지 선택지 컴포넌트, 필수 응답 문항 표시 컴포넌트 이렇게 문항 컴포넌트 코드 뭉탱이의 관심사가 분리되니까 읽기가 쉬워지고 디버깅도 훨씬 편해지는 느낌을 받았다.

코드만 정리한다고 해서 이런 큰 기능을 단박에 이해하기는 어려울 수 있다. 이를 위해 설문 진행 중 플로우에 대한 문서화를 진행했다. 나중에 합류하실 개발자들을 위해 코드 진행 흐름에 대한 문서화는 필수라고 생각했다.

![web-survey-3](../assets/web-survey-3.png)

웹 설문 내부에서 작동하는 비동기 액션을 모두 redux-saga로 대체했다. 컴포넌트 함수 내에서 작동하던 api 호출 관련 코드들을 제너레이터 함수로 분리해서 관리하기 시작했다. useEffect를 이용해서 처리하던 코드들을 이렇게 분리해 놓으니까 이런 장점들을 느낄 수 있었다.

1. 컴포넌트 함수의 관심사가 하나 줄었다. 전보다 읽기 좋은 코드가 되었다.
2. 예외처리 코드 작성이 훨씬 쉬워졌다. 각 제너레이터에 try... catch... 를 이용해서 예외를 잡기 시작했다.
3. 디버깅이 너무 빨라졌다. 예외 처리로 인해 어디서 에러가 나고있는지 찾을 필요가 없어졌고 그만큼 시간을 아낄 수 있었다.

### phase 4?

phase 3 이후로부터는 phase라고 단계를 나눌 것 없이 지속적인 기능 추가가 이뤄지고 있다. phase 3 작업 덕분에 그나마 편하게 기능 추가 작업을 할 수 있다고 생각한다. 추가적으로 단위 테스트를 진행하고 싶지만.. 비즈니스 로직 개발을 위해 잠깐 미뤄두고 있는 상태이다..

## 프로젝트 결과

- 포켓서베이의 카카오톡 의존도가 낮아졌다.
- B2C 사업의 확장성이 생겼다.
  - 기존 카카오톡 설문 시스템은 설문 발송 부분에서 비용이 책정되었다. (건당 N원)
    - ☞ 일반 사용자보다 기업 고객이 자신의 알림톡을 연동해서 카카오톡 설문을 발송하는 식으로 사용을 많이 했다.
  - 하지만 웹 설문은 카카오톡 설문과 다르게 공유하기가 편하고, 비용이 발생하지 않는다.
    - ☞ 일반 사용자가 사용하기가 편하다.
  - 그래서 B2C 사업의 가능성이 생겼다.
- 패턴 분리 작업을 경험하였다.
  - redux-saga를 이용해서 비동기 처리를 경험했다.
  - 관심사의 분리를 이용해서 컴포넌트를 작은 단위로 쪼개는 경험을 했다.
- 복잡한 로직을 가진 기능에 대한 빠른 이해를 위해 문서화 작업을 진행했다.

## 부족한 점

- 합리적인 방법을 찾는 능력이 필요하다.
- 아직 좋은 코드를 만드는 방법에 대해 능숙하지 않다고 생각한다.
